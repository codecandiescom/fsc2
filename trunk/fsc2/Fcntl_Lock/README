Fcntl_Lock version 0.06
=======================

Fcntl_Lock is a module to do file locking using the fcntl(2) system call.
This allows locks on parts of a file as well as the whole file and
overcomes some known problems with flock(2), on which Perls flock()
function often is based.

Obviously, to use the module you need a system that supports the fcntl()
system call.


INSTALLATION

To install this module type the following:

   perl Makefile.PL
   make
   make test
   make install


DEPENDENCIES

The module requires the following modules:

  POSIX, Errno, Carp


IMPLEMENTATION DETAILS

Basically, the module isn't much more than a wrapper for the fcntl()
function available in C. The somewhat trickier part was setting up the
required flock structure correctly in a hopefully system-independent way.
The concrete layout of this structure will be quite different on different
systems/architectures. The obvious solution would be to include fcntl.h
in the XS file and simply populate the members of the structure with the
data passed by the user.

Unfortunately, it isn't always that simple. E.g., on my system Perl has
been built with the flags LARGEFILE_SOURCE and FILE_OFFSET_BITS=64, which
differ from the settings that have been used when compiling the kernel.
This results in the declaration of the flock structure to be different
when including fcntl.h in the XS file (where the compilation flags Perl was
built with are set) from the one needed to call fcntl(). Thus, before the
XS file is compiled a C program is run (without the flags) that determines
the real size and alignment of the flock structure and writes out an
include file. The data from this file are then used to populate (or extract
data from) the flock structure of the correct type.


ACKNOWLEDGMENTS

Thanks to Mark-Jason Dominus <mjd@plover.com> and Benjamin Goldberg
<goldbb2@earthlink.net> for discussions, code and encouragement.

COPYRIGHT AND LICENCE

This program is free software; you can redistribute it and/or modify it
under the same terms as Perl itself.

Copyright (C) 2002-2006 Jens Thoms Toerring <jt@toerring.de>
